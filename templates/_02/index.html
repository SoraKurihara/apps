{% extends "base.html" %}

{% block style %}
<link rel=stylesheet type=text/css href="{{ url_for('static', filename='style_two.css') }}">
{% endblock %}

{% block content %}
<h1>モザイク加工</h1>
<form id="imageForm" action="/_02/result" method="POST" enctype="multipart/form-data">
    <input type="file" name="file" id="file" onchange="previewFile()">
    <input type="hidden" name="coordinates" id="coordinates">
    <input type="submit" value="実行" id="executeButton">
</form>
<canvas id="imageCanvas"></canvas>
<script src="{{ url_for('static', filename='selectArea.js') }}"></script>

<script>
    let canvas = document.getElementById('imageCanvas');
    let ctx = canvas.getContext('2d');
    let startX, startY, endX, endY;

    canvas.addEventListener('mousedown', function (e) {
        startX = e.clientX;
        startY = e.clientY;
    });

    canvas.addEventListener('mouseup', function (e) {
        endX = e.clientX;
        endY = e.clientY;

        // Draw the selected area
        ctx.rect(startX, startY, endX - startX, endY - startY);
        ctx.stroke();

        // Save coordinates
        document.getElementById('coordinates').value = `${startX},${startY},${endX},${endY}`;
    });

    function previewFile() {
        const file = document.getElementById('file').files[0];
        const reader = new FileReader();

        reader.addEventListener('load', function () {
            const img = new Image();
            img.src = reader.result;

            img.onload = function () {
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);
            };
        }, false);

        if (file) {
            reader.readAsDataURL(file);
        }
    }
</script>
{% endblock %}
